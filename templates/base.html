<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LavanderCats Cat Farm</title>

    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS for fallback images -->
    <link rel="stylesheet" href="/static/css/fallback-images.css">

    <!-- Custom colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'beige': '#F5F5DC',
                        'warm-beige': '#F0E8D8',
                        'soft-gray': '#E5E5E5',
                        'dusty-rose': '#D4A4A4',
                        'muted-pink': '#E8D5D5'
                    }
                }
            }
        }
    </script>

    <!-- Alpine.js Store -->
    <script>
    document.addEventListener('alpine:init', () => {
        Alpine.store('carousel', {
            images: [
                "https://images.unsplash.com/photo-1519052537078-e6302a4968d4?auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1518791841217-8f162f1e1131?auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1472491235688-bdc81a63246e?auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1541781774459-bb2af2f05b55?auto=format&fit=crop&w=800&q=80"
            ],
            active: 0,
            isMobile: false,
            autoPlayInterval: null,
            virtualIndex: 0,
            isTransitioning: false,
            extendedImages: [],

            init() {
                this.checkScreenSize();
                this.createExtendedImages();
                this.virtualIndex = this.images.length * 50; // Start in the middle for bidirectional infinite scroll
                this.updateCarousel();
                window.addEventListener('resize', () => {
                    this.checkScreenSize();
                    this.updateCarousel();
                });
                this.startAutoPlay();
            },

            createExtendedImages() {
                const repeats = 100; // Enough duplicates for seamless looping without performance issues
                this.extendedImages = Array(repeats).fill(this.images).flat();
            },

            checkScreenSize() {
                this.isMobile = window.innerWidth < 768;
            },

            next() {
                if (this.isTransitioning) return;
                this.isTransitioning = true;

                this.virtualIndex++;
                this.active = (this.active + 1) % this.images.length;
                this.updateCarousel();

                setTimeout(() => {
                    this.isTransitioning = false;
                    this.checkBounds();
                }, 500);
            },

            prev() {
                if (this.isTransitioning) return;
                this.isTransitioning = true;

                this.virtualIndex--;
                this.active = this.active === 0 ? this.images.length - 1 : this.active - 1;
                this.updateCarousel();

                setTimeout(() => {
                    this.isTransitioning = false;
                    this.checkBounds();
                }, 500);
            },

            goToSlide(index) {
                if (this.isTransitioning) return;
                this.isTransitioning = true;

                const steps = index - this.active;
                this.virtualIndex += steps;
                this.active = index;
                this.updateCarousel();

                setTimeout(() => {
                    this.isTransitioning = false;
                    this.checkBounds();
                }, 500);
            },

            checkBounds() {
                const totalImages = this.extendedImages.length;
                const imageCount = this.images.length;
                const middle = Math.floor(totalImages / 2);

                // Reset virtualIndex to prevent drift and maintain performance
                if (this.virtualIndex >= middle + imageCount) {
                    this.virtualIndex -= imageCount;
                    this.updateCarousel(false); // Reset without animation to avoid jumps
                } else if (this.virtualIndex < middle - imageCount) {
                    this.virtualIndex += imageCount;
                    this.updateCarousel(false); // Reset without animation
                }
            },

            updateCarousel(animate = true) {
                const carousel = this.$refs.carousel;
                if (!carousel) return;

                carousel.style.transition = animate ? 'transform 0.5s ease-out' : 'none';

                if (this.isMobile) {
                    // Use virtualIndex for infinite scroll on mobile
                    const offset = - (this.virtualIndex % this.extendedImages.length) * 100;
                    carousel.style.transform = `translateX(${offset}%)`;
                } else {
                    const containerWidth = carousel.parentElement.offsetWidth;
                    const imageWidth = 600; // Adjusted for visibility
                    const gap = 24; // Matches mx-3 in Tailwind (12px each side)
                    const slideWidth = imageWidth + gap;
                    const centerPosition = (containerWidth - imageWidth) / 2;
                    const offset = centerPosition - (this.virtualIndex * slideWidth);
                    carousel.style.transform = `translateX(${offset}px)`;
                }
            },

            startAutoPlay() {
                this.stopAutoPlay();
                this.autoPlayInterval = setInterval(() => {
                    this.next();
                }, 6000);
            },

            stopAutoPlay() {
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                    this.autoPlayInterval = null;
                }
            },

            isActiveImage(index) {
                return index % this.images.length === this.active;
            }
        });
    });
    </script>

    <!-- Alpine.js from CDN -->
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
</head>
<body class="bg-beige">
    <!-- Navigation bar -->
    <!-- Replace your nav with this CSS-only version -->
    <nav class="bg-warm-beige border-b border-soft-gray p-4">
        <div class="container mx-auto px-4 lg:px-16">
            <div class="flex justify-between items-center">
                <!-- Logo and title -->
                <div class="flex items-center space-x-3">
                    <img src="/static/images/logo.png" alt="LavanderCats Logo" class="h-10 w-10 rounded-full">
                    <h1 class="text-xl font-bold text-black">LavanderCats Cat Farm</h1>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex space-x-6">
                    <a href="/" class="text-black hover:text-dusty-rose transition-colors">Home</a>
                    <a href="/our-cats" class="text-black hover:text-dusty-rose transition-colors">Our Cats</a>
                    <a href="/cats" class="text-black hover:text-dusty-rose transition-colors">Available Kittens</a>
                    <a href="/news" class="text-black hover:text-dusty-rose transition-colors">News</a>
                    <a href="/documents" class="text-black hover:text-dusty-rose transition-colors">Documents</a>
                    <a href="/adoption-terms" class="text-black hover:text-dusty-rose transition-colors">Terms</a>
                    <a href="/privacy-policy" class="text-black hover:text-dusty-rose transition-colors">Privacy</a>
                </div>

                <!-- Simple mobile menu (dropdown style) -->
                <div class="md:hidden relative">
                    <input type="checkbox" id="mobile-menu-toggle" class="hidden">
                    <label for="mobile-menu-toggle" class="cursor-pointer">
                        <div class="w-6 h-6 flex flex-col justify-center items-center">
                            <div class="w-5 h-0.5 bg-black"></div>
                            <div class="w-5 h-0.5 bg-black mt-1"></div>
                            <div class="w-5 h-0.5 bg-black mt-1"></div>
                        </div>
                    </label>

                    <!-- Mobile dropdown (hidden by default) -->
                    <div class="absolute right-0 top-8 hidden bg-warm-beige border border-soft-gray rounded-lg shadow-lg p-4 z-50" id="mobile-menu">
                        <div class="flex flex-col space-y-3 min-w-32">
                            <a href="/" class="text-black hover:text-dusty-rose transition-colors">ğŸ  Home</a>
                            <a href="/our-cats" class="text-black hover:text-dusty-rose transition-colors">ğŸ‘‘ Our Cats</a>
                            <a href="/cats" class="text-black hover:text-dusty-rose transition-colors">ğŸ± Available Kittens</a>
                            <a href="/news" class="text-black hover:text-dusty-rose transition-colors">ğŸ“° News</a>
                            <a href="/documents" class="text-black hover:text-dusty-rose transition-colors">ğŸ“„ Documents</a>
                            <a href="/adoption-terms" class="text-black hover:text-dusty-rose transition-colors">ğŸ“‹ Terms</a>
                            <a href="/privacy-policy" class="text-black hover:text-dusty-rose transition-colors">ğŸ”’ Privacy</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <style>
        #mobile-menu-toggle:checked + label + #mobile-menu {
            display: block !important;
        }
    </style>

    <!-- Main content area -->
    <main class="container mx-auto p-6">
        {% block content %}
        <!-- Page content goes here -->
        {% endblock %}
    </main>
</body>
</html>
