{% extends "base.html" %}

{% block title %}News & Updates - RocKaRan Cat Farm{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50">
    <div class="container mx-auto px-4 py-12">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-gray-800 mb-4">ðŸ“° News & Updates</h1>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">Stay updated with the latest news from RocKaRan Cat Farm - new arrivals, events, and cat care tips.</p>
        </div>

        <!-- Articles Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12" id="articlesContainer">
            <!-- Articles will be loaded here via JavaScript -->
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="flex justify-center items-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"></div>
        </div>

        <!-- No Articles Message -->
        <div id="noArticles" class="text-center py-12 hidden">
            <h2 class="text-2xl font-bold text-gray-600 mb-4">No articles available</h2>
            <p class="text-gray-500">Check back later for the latest news and updates!</p>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center items-center space-x-2 mt-12 hidden">
            <button id="prevBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Previous
            </button>
            <span id="pageInfo" class="text-gray-600"></span>
            <button id="nextBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Next
            </button>
        </div>
    </div>
</div>

<script>
let currentPage = 1;
let totalPages = 1;
const articlesPerPage = 9;

async function loadArticles(page = 1) {
    const loadingSpinner = document.getElementById('loadingSpinner');
    const articlesContainer = document.getElementById('articlesContainer');
    const noArticles = document.getElementById('noArticles');

    loadingSpinner.classList.remove('hidden');
    articlesContainer.innerHTML = '';

    try {
        const response = await fetch(`/api/articles/`);
        const articles = await response.json();

        // Filter only published articles
        const publishedArticles = articles.filter(article => article.published);

        if (publishedArticles.length === 0) {
            noArticles.classList.remove('hidden');
            loadingSpinner.classList.add('hidden');
            return;
        }

        noArticles.classList.add('hidden');

        // Calculate pagination
        totalPages = Math.ceil(publishedArticles.length / articlesPerPage);
        const startIndex = (page - 1) * articlesPerPage;
        const endIndex = startIndex + articlesPerPage;
        const articlesToShow = publishedArticles.slice(startIndex, endIndex);

        // Display articles
        articlesToShow.forEach(article => {
            const articleCard = createArticleCard(article);
            articlesContainer.appendChild(articleCard);
        });

        // Update pagination
        updatePagination(page, totalPages);

    } catch (error) {
        console.error('Error loading articles:', error);
        articlesContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-red-600">Error loading articles. Please try again later.</p></div>';
    } finally {
        loadingSpinner.classList.add('hidden');
    }
}

function createArticleCard(article) {
    const card = document.createElement('div');
    card.className = 'bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 group';

    const publishDate = new Date(article.created_at).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    card.innerHTML = `
        <div class="relative overflow-hidden">
            ${article.featured_image ?
                `<img src="${article.featured_image}" alt="${article.title}" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-500">` :
                `<div class="w-full h-48 bg-gradient-to-br from-amber-200 to-orange-200 flex items-center justify-center">
                    <span class="text-4xl">ðŸ“°</span>
                </div>`
            }
        </div>
        <div class="p-6">
            <div class="text-sm text-gray-500 mb-2">${publishDate}</div>
            <h3 class="text-xl font-bold text-gray-800 mb-3 group-hover:text-amber-600 transition-colors">${article.title}</h3>
            <p class="text-gray-600 mb-4 line-clamp-3">${article.content.substring(0, 150)}${article.content.length > 150 ? '...' : ''}</p>
            <div class="flex justify-between items-center">
                <span class="text-sm text-gray-500">By ${article.author}</span>
                <button onclick="openArticleModal(${article.id})" class="text-amber-600 hover:text-amber-700 font-semibold transition-colors">
                    Read More â†’
                </button>
            </div>
        </div>
    `;

    return card;
}

function updatePagination(current, total) {
    const pagination = document.getElementById('pagination');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const pageInfo = document.getElementById('pageInfo');

    if (total <= 1) {
        pagination.classList.add('hidden');
        return;
    }

    pagination.classList.remove('hidden');
    pageInfo.textContent = `Page ${current} of ${total}`;

    prevBtn.disabled = current <= 1;
    nextBtn.disabled = current >= total;

    prevBtn.onclick = () => loadArticles(current - 1);
    nextBtn.onclick = () => loadArticles(current + 1);
}

function openArticleModal(articleId) {
    // For now, just redirect to a detail page
    // In a future enhancement, we could open a modal
    window.location.href = `/article/${articleId}`;
}

// Load articles when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadArticles(1);
});
</script>

<style>
.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>

{% endblock %}
